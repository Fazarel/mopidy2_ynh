#!/bin/bash

# Exit on command errors and treat unset variables as an error
set -u

source .fonctions	# Charge les fonctions génériques habituellement utilisées dans le script

# Source app helpers
source /usr/share/yunohost/helpers

# Get application informations
app=$YNH_APP_INSTANCE_NAME
domain=$(ynh_app_setting_get $app domain)

# Remove application
sudo apt-get remove --purge -y mopidy
sleep 4
sudo pip uninstall mopidy_musicbox_webclient
sleep 4

# Delete stupid file
# sudo rm -fr /root/.config/mopidy
# sudo rm -fr /root/.cache/mopidy
# sudo rm -fr /root/.local/share/mopidy
sudo rm -fr /usr/local/bin/mopidy
sudo rm -fr /usr/share/mopidy
sudo rm -fr /var/lib/mopidy
sudo rm -fr /etc/apt/sources.list.d/mopidy.list
sudo rm -fr /usr/local/lib/python2.7/dist-packages/Mopidy_MusicBox_Webclient-2.3.0-py2.7.egg
sudo rm -fr /tmp/mopidy-musicbox-webclient

# disallow firewall port
sudo yunohost firewall disallow TCP 6600
sudo yunohost firewall disallow TCP 6680

SECURE_REMOVE '/var/www/$app'	# Suppression du dossier de l'application

REMOVE_NGINX_CONF	# Suppression de la configuration nginx

# Régénère la configuration de SSOwat
sudo yunohost app ssowatconf

echo -e "\e[0m"	# Restore normal color